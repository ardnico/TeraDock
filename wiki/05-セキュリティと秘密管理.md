# ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ç§˜å¯†ç®¡ç†

## æš—å·åŒ–æ–¹é‡
- Secretï¼ˆpassword/token/passphraseï¼‰ã¯å¸¸ã«æš—å·åŒ–ä¿å­˜ã—ã€`td show` ã§ã¯å€¤ã‚’è¡¨ç¤ºã—ãªã„ã€‚ã€F:PROJECT_PLAN.mdâ€ L147-L177ã€‘
- `td secret reveal` ã¯ master ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šæ¸ˆã¿ã®ã¨ãã®ã¿è¨±å¯ã—ã€ãƒ­ã‚°ã« Secret ã‚’æ®‹ã•ãªã„ã€‚ã€F:PROJECT_PLAN.mdâ€ L147-L177ã€‘ã€F:EXTERNAL_DESIGN.mdâ€ L97-L105ã€‘
- æš—å·æ–¹å¼: Argon2id ã§éµå°å‡ºã—ã€XChaCha20-Poly1305 ã§ AEAD æš—å·åŒ–ã€‚Aad ã«ã¯ `secret_id` ã¨ `kind` ã‚’å«ã‚å–ã‚Šé•ãˆã‚’é˜²æ­¢ã€‚ã€F:PROJECT_PLAN.mdâ€ L155-L169ã€‘

```mermaid
flowchart LR
  input[Master password] --> kdf[Argon2id KDF]
  kdf --> masterKey[master_key]
  secret[Plain secret] --> encrypt[XChaCha20-Poly1305\nnonce per secret]
  masterKey --> encrypt
  encrypt --> ciphertext[Ciphertext + nonce]
  ciphertext --> storage[(secrets table)]
  decrypt[Reveal command] --> kdf
  masterKey --> decrypt
  decrypt --> display[One-time display\n(masked in logs)]
```

## è¡¨ç¤ºãƒ»ãƒ­ã‚°ã®åˆ¶å¾¡
- `danger_level=critical` ã¯ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’äºŒæ®µéšã«ã—ã€Secret ã‚’å«ã‚€ã‚³ãƒãƒ³ãƒ‰å¼•æ•°ã¯ãƒã‚¹ã‚¯ã™ã‚‹ã€‚ã€F:PROJECT_PLAN.mdâ€ L197-L200ã€‘ã€F:EXTERNAL_DESIGN.mdâ€ L120-L137ã€‘
- ãƒ­ã‚°ã¨ dry-run å‡ºåŠ›ã§ã¯ Secret ã‚’å‡ºã•ãªã„ã€‚FTP å®Ÿè¡Œã¯å®‰å…¨è£…ç½®ãƒ•ãƒ©ã‚°ãŒãªã„é™ã‚Šæ‹’å¦ã—ã€insecure å®Ÿè¡Œæ™‚ã¯æ˜ç¤ºçš„ã«è¨˜éŒ²ã™ã‚‹ã€‚ã€F:EXTERNAL_DESIGN.mdâ€ L146-L159ã€‘ã€F:PROJECT_PLAN.mdâ€ L257-L260ã€‘

## ã‚µãƒ³ãƒ—ãƒ«è¨­å®šï¼ˆæ¦‚å¿µï¼‰
```toml
# secrets encryption parameters
[security]
master_kdf = "argon2id"      # ã€F:PROJECT_PLAN.mdâ€ L155-L160ã€‘
master_cipher = "xchacha20poly1305"
mask_rules = ["password", "token"]

# transfer safety gates
[transfer]
allow_insecure_transfers = false  # require explicit opt-in for FTP
```

## å¯¾ç­–ã¨æ®‹èª²é¡Œ
- Serial/Telnet ã®å…¥å‡ºåŠ›ä¹±ã‚Œã‚’é¿ã‘ã‚‹ãŸã‚ã€v0.1 ã¯ raw passthrough ã®ã¿ã«æŠ‘ãˆã‚‹ã€‚ã€F:PROJECT_PLAN.mdâ€ L226-L242ã€‘
- Config apply äº‹æ•…ã‚’é˜²ããŸã‚ `--plan` ã¨ `--backup` ã‚’æ¨™æº–å‹•ä½œã«è¿‘ã¥ã‘ã‚‹ã€‚ã€F:PROJECT_PLAN.mdâ€ L577-L580ã€‘
- ä»Šå¾Œã®èª²é¡Œ: master ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æœªè¨­å®šçŠ¶æ…‹ã§ã® UXï¼ˆè¨­å®šã‚’ä¿ƒã™ã‹ã©ã†ã‹ï¼‰ã€Secret å‚ç…§æ¨©é™ã®ç´°åˆ†åŒ–ã€‚

ãƒ†ã‚¹ãƒˆè¦³ç‚¹ã¯ [ãƒ†ã‚¹ãƒˆã¨ãƒªãƒªãƒ¼ã‚¹è¨ˆç”»](./06-ãƒ†ã‚¹ãƒˆã¨ãƒªãƒªãƒ¼ã‚¹è¨ˆç”».md) ã‚’ç¢ºèªã€‚
